- name: create directories
  file:
    state: directory
    path: /etc/systemd/system/kubelet.service.d

- name: configure
  template:
    src: "{{ item }}.j2"
    dest: "/{{ item }}"
  loop:
    - etc/kubernetes/kubelet-config.yaml
    - etc/systemd/system/kubelet.service.d/override.conf
  notify:
    - systemctl deamon-reload
    - systemctl restart kubelet

- meta: flush_handlers

- name: Start kubelet
  service:
    name: kubelet
    state: started
    enabled: yes
